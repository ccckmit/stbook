<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../css/book.css" type="text/css" />
</head>
<body>
<div id="header_wrap">
  <h1><a href="book.html">機率統計-使用 R 軟體實作</a></h1>
  <table id="bar" border="0" style="border:0;"><tr style="border:0;">
    <td style="text-align:left;border:0;"> <a href="book.html">目錄</a> | <a href="download.html">下載</a> | <a href="course.html">課程</a> | <a href="forum.html">討論</a> | <a href="exam.html">測驗</a></td>
    <td style="text-align:right;border:0;"><a href="http://ccckmit.wikidot.com/">陳鍾誠</a> 於 <a href="http://www.nqu.edu.tw/">金門大學</a></td>
  </tr></table>
</div>
<div id="content">
<div id="TOC">
<ul>
<li><a href="#貝氏網路-bayisian-network">貝氏網路 (Bayisian Network)</a><ul>
<li><a href="#貝氏定理-bayes-theorem">貝氏定理 (Bayes Theorem)</a></li>
<li><a href="#原始貝氏模型-naive-bayes">原始貝氏模型 (Naive Bayes)</a></li>
<li><a href="#簡單貝氏模型">簡單貝氏模型</a></li>
<li><a href="#貝氏網路-bayisian-network-1">貝氏網路 (Bayisian Network)</a></li>
<li><a href="#參考文獻">參考文獻</a></li>
</ul></li>
</ul>
</div>
<h1 id="貝氏網路-bayisian-network"><a href="#貝氏網路-bayisian-network">貝氏網路 (Bayisian Network)</a></h1>
<h2 id="貝氏定理-bayes-theorem"><a href="#貝氏定理-bayes-theorem">貝氏定理 (Bayes Theorem)</a></h2>
<ol style="list-style-type: decimal">
<li><img src="../timg/1b8b3c2644d4.jpg" /></li>
<li><img src="../timg/c291be1b2852.jpg" /></li>
<li><img src="../timg/7f89c3442d08.jpg" title="fig:" /></li>
</ol>
<h2 id="原始貝氏模型-naive-bayes"><a href="#原始貝氏模型-naive-bayes">原始貝氏模型 (Naive Bayes)</a></h2>
<p>原始貝氏模型 (Naive Bayes, 又被稱為簡單貝氏模型 (Naive Bayes Model) 或原始貝氏分類器 Naive Bayesian Classifier)</p>
<p>給定隨機變數 Z 後，X 與 Y 條件獨立的定義為</p>
<div class="figure">
<img src="../timg/83a96ad2ac9b.jpg" />
</div>
<p>公式： <img src="../timg/33563bb6f272.jpg" /></p>
<h3 id="範例牙痛問題"><a href="#範例牙痛問題">範例：牙痛問題</a></h3>
<p>範例： <img src="../timg/993d2bedc14c.jpg" /></p>
<p>本問題來自人工智慧的經典教科書 「Artificial Intelligence: A Modern Approach」第三版，475 頁。</p>
<p>問題描述：當病人來看牙醫時，該病人可能有蛀牙或沒蛀牙，也可能有牙痛或沒有牙痛，而牙醫可能會找到牙痛的原因或找不到。</p>
<p>因此有下列三個隨機變數</p>
<p>X:(蛀) 蛀牙與否 (Cavity) Y:(痛) 牙痛與否 (Toothache) Z:(找) 是否找到痛的牙 (Catch)</p>
<p>假如這個問題個統計機率都已經知道了，如下表所示。</p>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">牙痛 (Y=1)</th>
<th align="left"></th>
<th align="left">不牙痛 (Y=0)</th>
<th align="left"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">找到 (Z=1)</td>
<td align="left">找不到 (Z=0)</td>
<td align="left">找到 (Z=1)</td>
<td align="left">找不到 (Z=0)</td>
</tr>
<tr class="even">
<td align="left">蛀牙(X=1)</td>
<td align="left">0.108</td>
<td align="left">0.012</td>
<td align="left">0.072</td>
<td align="left">0.008</td>
</tr>
<tr class="odd">
<td align="left">沒蛀牙 (X=0)</td>
<td align="left">0.016</td>
<td align="left">0.064</td>
<td align="left">0.144</td>
<td align="left">0.576</td>
</tr>
</tbody>
</table>
<p>如果將這個表格寫成一整排，那麼將會以下列機率表格顯示。</p>
<table>
<thead>
<tr class="header">
<th align="left">蛀 X</th>
<th align="left">痛 Y</th>
<th align="left">找 Z</th>
<th align="left">P(X,Y,Z)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0.576</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0.144</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.064</td>
</tr>
<tr class="even">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.016</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0.008</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0.072</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.012</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.108</td>
</tr>
</tbody>
</table>
<p>問題</p>
<p>習題1：請計算 P(沒痛) = P(Y=0) = ?</p>
<p>習題2：請計算 P(找到 | 牙痛) = ?</p>
<p>習題3：請問這是一個合理的機率分布嗎？</p>
<p>習題4：請計算 P(Z=1 | X=1) = ?</p>
<p>習題5：請計算 P(Z=1, Y=1) = ?</p>
<p>習題6：請計算 P(蛀 | 找到), P(蛀), P(找到), P(找到 | 蛀) ，然後驗證下列貝氏定理是否成立。</p>
<p>P(找到|蛀) = P(蛀|找到) </p>
<p>解答</p>
<p>由於 R 的 陣列是用以行為主的順序 (Column Major Order)，因此沒辦法直接與上列的表格對起來，請看下列檔案中的說明</p>
<p>http://cran.r-project.org/doc/manuals/R-lang.pdf</p>
<blockquote>
<p>2.2.2 The dim attribute is used to implement arrays. The content of the array is stored in a vector in column-major order and the dim attribute is a vector of integers specifying the respective extents of the array. R ensures that the length of the vector is the product of the lengths of the dimensions. The length of one or more dimensions may be zero.</p>
</blockquote>
<p>所以我們必須先將真值表改為以行為主的方式，改寫後如下表所示。</p>
<table>
<thead>
<tr class="header">
<th align="left">蛀 X</th>
<th align="left">痛 Y</th>
<th align="left">找 Z</th>
<th align="left">P(X,Y,Z)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0.576</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0.008</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.064</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0.012</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0.144</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">0.072</td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.016</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.108</td>
</tr>
</tbody>
</table>
<p>而且 R 的陣列是從 1 開始算的，不像 C 語言是從 0 開始算的，因此還必須將上表修改如下：</p>
<table>
<thead>
<tr class="header">
<th align="left">蛀 X</th>
<th align="left">痛 Y</th>
<th align="left">找 Z</th>
<th align="left">P(X,Y,Z)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.576</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0.008</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">0.064</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">0.012</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">0.144</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">1</td>
<td align="left">2</td>
<td align="left">0.072</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">0.016</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">2</td>
<td align="left">2</td>
<td align="left">0.108</td>
</tr>
</tbody>
</table>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>p &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">c</span>(<span class="fl">0.576</span>, <span class="fl">0.008</span>, <span class="fl">0.064</span>, <span class="fl">0.012</span>, <span class="fl">0.144</span>, <span class="fl">0.072</span>, <span class="fl">0.016</span>, <span class="fl">0.108</span>),<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))
&gt;<span class="st"> </span>p
, , <span class="dv">1</span>

      [,<span class="dv">1</span>]  [,<span class="dv">2</span>]
[<span class="dv">1</span>,] <span class="fl">0.576</span> <span class="fl">0.064</span>
[<span class="dv">2</span>,] <span class="fl">0.008</span> <span class="fl">0.012</span>

, , <span class="dv">2</span>

      [,<span class="dv">1</span>]  [,<span class="dv">2</span>]
[<span class="dv">1</span>,] <span class="fl">0.144</span> <span class="fl">0.016</span>
[<span class="dv">2</span>,] <span class="fl">0.072</span> <span class="fl">0.108</span>

&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.576</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.008</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.064</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.012</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.144</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.072</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.016</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.108</span>
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒蛀&quot;</span>, <span class="st">&quot;蛀&quot;</span>)
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒痛&quot;</span>, <span class="st">&quot;痛&quot;</span>)
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">3</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒找&quot;</span>, <span class="st">&quot;找&quot;</span>)
&gt;<span class="st"> </span>p
, , 沒找

<span class="st">      </span>沒痛    痛
沒蛀 <span class="fl">0.576</span> <span class="fl">0.064</span>
蛀   <span class="fl">0.008</span> <span class="fl">0.012</span>

, , 找

<span class="st">      </span>沒痛    痛
沒蛀 <span class="fl">0.144</span> <span class="fl">0.016</span>
蛀   <span class="fl">0.072</span> <span class="fl">0.108</span></code></pre>
<p>解答1：P(沒痛) = 0.8 計算過程：</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>p[,<span class="st">&quot;沒痛&quot;</span>,]
      沒找<span class="st">    </span><span class="er">找</span>
沒蛀 <span class="fl">0.576</span> <span class="fl">0.144</span>
蛀   <span class="fl">0.008</span> <span class="fl">0.072</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;沒痛&quot;</span>,])
[<span class="dv">1</span>] <span class="fl">0.8</span></code></pre>
<p>解答2：P(找到 | 牙痛) = 0.62</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>p[,,<span class="st">&quot;找&quot;</span>]
      沒痛    痛
沒蛀 <span class="fl">0.144</span> <span class="fl">0.016</span>
蛀   <span class="fl">0.072</span> <span class="fl">0.108</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>])
[<span class="dv">1</span>] <span class="fl">0.34</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,<span class="st">&quot;找&quot;</span>])
[<span class="dv">1</span>] <span class="fl">0.124</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(<span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,]))
[<span class="dv">1</span>] <span class="fl">0.62</span></code></pre>
<p>解答3：請問這是一個合理的機率分布嗎？ (是的，因為總和為 1，而且每個機率直都介於 0 到1之間)</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">sum</span>(p)
[<span class="dv">1</span>] <span class="dv">1</span>
&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p&lt;=<span class="dv">1</span>
錯誤:<span class="st"> </span>unexpected <span class="st">&#39;&lt;=&#39;</span> in <span class="st">&quot;0&lt;=p&lt;=&quot;</span>
&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

&gt;<span class="st"> </span>p&lt;=<span class="dv">1</span>
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p &amp;<span class="st"> </span>p &lt;=<span class="dv">1</span>
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span></code></pre>
<p>解答4：請計算 P(Z=1 | X=1) = 0.9</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st">  </span><span class="kw">sum</span>(p[<span class="dv">2</span>,,<span class="dv">2</span>])/<span class="kw">sum</span>(p[<span class="dv">2</span>,,])
[<span class="dv">1</span>] <span class="fl">0.9</span></code></pre>
<p>解答5：請計算 P(Z=1, Y=1) = 0.124</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>p[,<span class="dv">2</span>,<span class="dv">2</span>]
 沒蛀    蛀 
<span class="fl">0.016</span> <span class="fl">0.108</span> 
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="dv">2</span>,<span class="dv">2</span>])
[<span class="dv">1</span>] <span class="fl">0.124</span></code></pre>
<p>解答6：請計算 P(蛀 | 找到), P(蛀), P(找到), P(找到 | 蛀) ，然後驗證下列貝氏定理是否成立。</p>
<blockquote>
<p>P(蛀 | 找到) = p(找到|蛀) * p(蛀)/p(找到)</p>
</blockquote>
<p>說明：</p>
<p>P(蛀 | 找到) = 0.5294118, P(蛀)=0.2, P(找到)=0.34, P(找到 | 蛀)=0.9</p>
<p>P(蛀 | 找到) = 0.5294118 = 0.9 * 0.2/0.34 = = p(找到|蛀) * p(蛀)/p(找到)</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>pab =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>]) ; pab =<span class="st"> </span><span class="kw">P</span>(蛀 |<span class="st"> </span><span class="er">找</span><span class="dv">到</span>)
&gt;<span class="st"> </span>pba =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,]) ; pba =<span class="st"> </span><span class="kw">P</span>(找<span class="dv">到</span> |<span class="st"> </span>蛀)
&gt;<span class="st"> </span>pa =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,]) ; pa =<span class="st"> </span><span class="kw">P</span>(蛀)
&gt;<span class="st"> </span>pb =<span class="st"> </span><span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>]) ; pb =<span class="st"> </span><span class="kw">P</span>(找<span class="dv">到</span>)
&gt;<span class="st"> </span>pab
[<span class="dv">1</span>] <span class="fl">0.5294118</span>
&gt;<span class="st"> </span>pba
[<span class="dv">1</span>] <span class="fl">0.9</span>
&gt;<span class="st"> </span>pa
[<span class="dv">1</span>] <span class="fl">0.2</span>
&gt;<span class="st"> </span>pb
[<span class="dv">1</span>] <span class="fl">0.34</span>
&gt;<span class="st"> </span>pba*pa/pb
[<span class="dv">1</span>] <span class="fl">0.5294118</span>
&gt;<span class="st"> </span>pab-pba*pa/pb
[<span class="dv">1</span>] <span class="dv">0</span>
&gt;<span class="st"> </span></code></pre>
<p>所以</p>
<pre class="sourceCode R"><code class="sourceCode r"><span class="kw">p</span>(蛀|<span class="er">找</span>) 
=<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>]) 
=<span class="st"> </span>pab 
=<span class="st"> </span>pba *<span class="st"> </span>pa /<span class="st"> </span>pb 
=<span class="st"> </span><span class="kw">p</span>(找<span class="er">|</span>蛀) *<span class="st"> </span><span class="kw">p</span>(蛀)/<span class="kw">p</span>(找) 
=<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[,,<span class="st">&quot;蛀&quot;</span>])*<span class="st"> </span><span class="kw">sum</span>(p[,,<span class="st">&quot;蛀&quot;</span>])/<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;找&quot;</span>,,])</code></pre>
<p>完整的操作過程</p>
<pre class="sourceCode R"><code class="sourceCode r">&gt;<span class="st"> </span>p &lt;-<span class="st"> </span><span class="kw">array</span>(<span class="kw">c</span>(<span class="fl">0.576</span>, <span class="fl">0.008</span>, <span class="fl">0.064</span>, <span class="fl">0.012</span>, <span class="fl">0.144</span>, <span class="fl">0.072</span>, <span class="fl">0.016</span>, <span class="fl">0.108</span>),<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>))
&gt;<span class="st"> </span>p
, , <span class="dv">1</span>

      [,<span class="dv">1</span>]  [,<span class="dv">2</span>]
[<span class="dv">1</span>,] <span class="fl">0.576</span> <span class="fl">0.064</span>
[<span class="dv">2</span>,] <span class="fl">0.008</span> <span class="fl">0.012</span>

, , <span class="dv">2</span>

      [,<span class="dv">1</span>]  [,<span class="dv">2</span>]
[<span class="dv">1</span>,] <span class="fl">0.144</span> <span class="fl">0.016</span>
[<span class="dv">2</span>,] <span class="fl">0.072</span> <span class="fl">0.108</span>

&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.576</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.008</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.064</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>]
[<span class="dv">1</span>] <span class="fl">0.012</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.144</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.072</span>
&gt;<span class="st"> </span>p[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.016</span>
&gt;<span class="st"> </span>p[<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>]
[<span class="dv">1</span>] <span class="fl">0.108</span>
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">1</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒蛀&quot;</span>, <span class="st">&quot;蛀&quot;</span>)
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">2</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒痛&quot;</span>, <span class="st">&quot;痛&quot;</span>)
&gt;<span class="st"> </span><span class="kw">dimnames</span>(p)[[<span class="dv">3</span>]] =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;沒找&quot;</span>, <span class="st">&quot;找&quot;</span>)
&gt;<span class="st"> </span>p
, , 沒找

<span class="st">      </span>沒痛    痛
沒蛀 <span class="fl">0.576</span> <span class="fl">0.064</span>
蛀   <span class="fl">0.008</span> <span class="fl">0.012</span>

, , 找

<span class="st">      </span>沒痛    痛
沒蛀 <span class="fl">0.144</span> <span class="fl">0.016</span>
蛀   <span class="fl">0.072</span> <span class="fl">0.108</span>

&gt;<span class="st"> </span>p[,<span class="st">&quot;沒痛&quot;</span>,]
      沒找<span class="st">    </span><span class="er">找</span>
沒蛀 <span class="fl">0.576</span> <span class="fl">0.144</span>
蛀   <span class="fl">0.008</span> <span class="fl">0.072</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;沒痛&quot;</span>,])
[<span class="dv">1</span>] <span class="fl">0.8</span>
&gt;<span class="st"> </span>p[,,<span class="st">&quot;找&quot;</span>]
      沒痛    痛
沒蛀 <span class="fl">0.144</span> <span class="fl">0.016</span>
蛀   <span class="fl">0.072</span> <span class="fl">0.108</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>])
[<span class="dv">1</span>] <span class="fl">0.34</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,<span class="st">&quot;找&quot;</span>])
[<span class="dv">1</span>] <span class="fl">0.124</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(<span class="kw">sum</span>(p[,<span class="st">&quot;痛&quot;</span>,]))
[<span class="dv">1</span>] <span class="fl">0.62</span>
&gt;<span class="st"> </span><span class="kw">sum</span>(p)
[<span class="dv">1</span>] <span class="dv">1</span>
&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p&lt;=<span class="dv">1</span>
錯誤:<span class="st"> </span>unexpected <span class="st">&#39;&lt;=&#39;</span> in <span class="st">&quot;0&lt;=p&lt;=&quot;</span>
&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

&gt;<span class="st"> </span>p&lt;=<span class="dv">1</span>
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

&gt;<span class="st"> </span><span class="dv">0</span>&lt;=p &amp;<span class="st"> </span>p &lt;=<span class="dv">1</span>
, , 沒找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

, , 找

<span class="st">     </span>沒痛   痛
沒蛀 <span class="ot">TRUE</span> <span class="ot">TRUE</span>
蛀   <span class="ot">TRUE</span> <span class="ot">TRUE</span>

&gt;<span class="st"> </span><span class="kw">sum</span>(p[<span class="dv">2</span>,,<span class="dv">2</span>])/<span class="kw">sum</span>(p[<span class="dv">2</span>,,])
[<span class="dv">1</span>] <span class="fl">0.9</span>
&gt;<span class="st"> </span>p[,<span class="dv">2</span>,<span class="dv">2</span>]
 沒蛀    蛀 
<span class="fl">0.016</span> <span class="fl">0.108</span> 
&gt;<span class="st"> </span><span class="kw">sum</span>(p[,<span class="dv">2</span>,<span class="dv">2</span>])
[<span class="dv">1</span>] <span class="fl">0.124</span>
&gt;<span class="st"> </span>pab =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>])
&gt;<span class="st"> </span>pba =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,<span class="st">&quot;找&quot;</span>])/<span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,])
&gt;<span class="st"> </span>pa =<span class="st"> </span><span class="kw">sum</span>(p[<span class="st">&quot;蛀&quot;</span>,,])
&gt;<span class="st"> </span>pb =<span class="st"> </span><span class="kw">sum</span>(p[,,<span class="st">&quot;找&quot;</span>])
&gt;<span class="st"> </span>pab
[<span class="dv">1</span>] <span class="fl">0.5294118</span>
&gt;<span class="st"> </span>pba
[<span class="dv">1</span>] <span class="fl">0.9</span>
&gt;<span class="st"> </span>pa
[<span class="dv">1</span>] <span class="fl">0.2</span>
&gt;<span class="st"> </span>pb
[<span class="dv">1</span>] <span class="fl">0.34</span>
&gt;<span class="st"> </span>pba*pa/pb
[<span class="dv">1</span>] <span class="fl">0.5294118</span>
&gt;<span class="st"> </span>pab-pba*pa/pb
[<span class="dv">1</span>] <span class="dv">0</span>
&gt;<span class="st"> </span></code></pre>
<h2 id="簡單貝氏模型"><a href="#簡單貝氏模型">簡單貝氏模型</a></h2>
<p>簡單貝氏模型直接假設所有的隨機變數之間具有條件獨立的情況，因此可以直接利用條件機率相乘的方法，計算出聯合機率分布。</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="kw">public</span> <span class="kw">class</span> NaiveBayesModel : ProbModel
    {
        <span class="kw">public</span> HashSet&lt;Object&gt; C = <span class="kw">new</span> HashSet&lt;Object&gt;();
        <span class="kw">public</span> HashSet&lt;Object&gt; X = <span class="kw">new</span> HashSet&lt;Object&gt;();

        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">p</span>(String exp)
        {
         <span class="kw">if</span> (exp.<span class="fu">IndexOf</span>(<span class="st">&quot;|&quot;</span>) &gt;= <span class="dv">0</span>)
         {
         String[] x = exp.<span class="fu">head</span>(<span class="st">&quot;|&quot;</span>).<span class="fu">split</span>(<span class="st">&quot; &quot;</span>);
         String c = exp.<span class="fu">tail</span>(<span class="st">&quot;|&quot;</span>);
         <span class="co">// p(x1 x2 ... xn | c) = p(x1|c) ... p(xn|c)</span>
         <span class="kw">if</span> (x.<span class="fu">Length</span> &gt; <span class="dv">1</span> &amp;&amp; X.<span class="fu">containsAll</span>(x) &amp;&amp; C.<span class="fu">Contains</span>(c)) 
         <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">ruleProd</span>(x, c);
         }
         <span class="kw">return</span> <span class="kw">base</span>.<span class="fu">p</span>(exp);
        }
    }</code></pre>
<p>簡單貝氏模型的測試問題</p>
<p>問題：已知類別 C 決定隨機變數 X 的機率，類別 C 有 c1, c2 兩個可能值，X 也有 x1, x2 兩個可能值，但是不知 p(c1), p(x1|c1), p(x1|c2), 請問哪一種假設最符合觀察數據 x1 x2 ... xn，在此模型中，p(c2)=1-p(c1), p(x2|c1)=1-p(x1|c1), p(x2|c2)=1-p(x1,c2)，因此只有三個參數需要學習。</p>
<p>程式實作</p>
<pre class="sourceCode CS"><code class="sourceCode cs">    <span class="kw">public</span> <span class="kw">class</span> NaiveBayesProblem1 : ProbProblem
    {
        <span class="kw">public</span> <span class="fu">NaiveBayesProblem1</span>() 
        {
            <span class="fu">d</span>(<span class="st">&quot;c1&quot;</span>, <span class="fl">0.3</span>, <span class="st">&quot;c2&quot;</span>); <span class="fu">d</span>(<span class="st">&quot;x1|c1&quot;</span>, <span class="fl">0.7</span>, <span class="st">&quot;x2|c1&quot;</span>); <span class="fu">d</span>(<span class="st">&quot;x1|c2&quot;</span>, <span class="fl">0.5</span>, <span class="st">&quot;x2|c2&quot;</span>);
        }

        <span class="kw">public</span> <span class="kw">override</span> String <span class="fu">generate</span>()
        {
         String c = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;c1&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;c1&quot;</span>), <span class="st">&quot;c2&quot;</span>);
            String x = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;x1&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;x1|&quot;</span> + c), <span class="st">&quot;x2&quot;</span>);
         <span class="kw">return</span> c + <span class="st">&quot;,&quot;</span> + x;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">test</span>()
        {
            <span class="dt">var</span> model = <span class="kw">new</span> <span class="fu">NaiveBayesModel</span>();
            model.<span class="fu">C</span>.<span class="fu">addAll</span>(<span class="st">&quot;c1,c2&quot;</span>.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>)); model.<span class="fu">X</span>.<span class="fu">addAll</span>(<span class="st">&quot;x1,x2&quot;</span>.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>));
            <span class="fu">test</span>(model, <span class="st">&quot;c1;c2;x1|c1;x2|c1;x1|c2;x2|c2;x1 x2 x1 x2|c1&quot;</span>);
        }
    }</code></pre>
<h2 id="貝氏網路-bayisian-network-1"><a href="#貝氏網路-bayisian-network-1">貝氏網路 (Bayisian Network)</a></h2>
<p>使用貝氏網路計算聯合機率分佈</p>
<div class="figure">
<img src="../timg/2bb1fe016033.jpg" />
</div>
<p>使用貝氏網路計算事後機率分佈 P(X | e)</p>
<p>X:查詢變數 E 證據變數集 E1, E2, ... Em, e 代表一個觀察到的特定事件 Y 表示非證據變數集 Y1, Y2, ... Yl.</p>
<p>方法 1. 列舉式推理法 (Enumeration) (較慢)</p>
<div class="figure">
<img src="../timg/b6ec0e28f4c6.jpg" />
</div>
<p>方法 2. 變數消元演算法 (Variable Elimination Algorithm) (較快 <img src="../timg/9f84a66d88d2.jpg" /> )</p>
<p>類似動態規畫，不需要重覆計算已知結果</p>
<p>方法 3. 聯合樹演算法 (Joint Tree Algorithm) (最快 <img src="../timg/7ba55e7c64a9.jpg" /> )</p>
<h3 id="在貝氏網路中使用蒙地卡羅法"><a href="#在貝氏網路中使用蒙地卡羅法">在貝氏網路中使用蒙地卡羅法</a></h3>
<p>(1). 使用貝氏網路進行取樣</p>
<pre><code>Algorithm Prior-Sample(bn) returns an event sampled from the prior specified by Bayes Network (bn)
  input : bn, a Bayesian network specifying joint distribution [[ ![](../timg/a7ca5f56a51d.jpg) ]]
  x = an event with n elements
  for i=1 to n do 
    xi = a random sample from [[ ![](../timg/4ae7b35d38cb.jpg) ]]
  return x</code></pre>
<p>(2). 直接取樣演算法 (Direct Sampling Method)</p>
<p>目標：計算出所有的 [[ <img src="../timg/d37eac3fce88.jpg" /> ]], 也就是 [[ <img src="../timg/a7ca5f56a51d.jpg" /> ]] * 步驟 1. 利用網路架構，從無父節點的變數開始，進行取樣動作，其方法是逐步利用 [[ <img src="../timg/8d7fad03f69b.jpg" /> ]] 的取樣方式，完成一次取樣動作。 * 步驟 2. 重複 (步驟 1) ，總共取樣 N 次，然後就得到一系列的樣本 [[ <img src="../timg/ce350fb88950.jpg" /> ]] * 步驟 3. 任一個樣本 [[ <img src="../timg/053777b46990.jpg" /> ]] 的出現機率即為 [[ <img src="../timg/672eae0457a7.jpg" /> ]]</p>
<p>數學原理</p>
<div class="figure">
<img src="../timg/1fd5e2d589cb.jpg" />
</div>
<div class="figure">
<img src="../timg/bc13c1f09b99.jpg" />
</div>
<pre><code>Algorithm Direct-Sampling(X, bn, N)
  input : X , the query variable
             bn, a Bayesian network specifying joint distribution [[ ![](../timg/a7ca5f56a51d.jpg) ]]
             N, the total number of samples to be generated
  for i=1 to N do
      x = Prior-Sampling(bn)
      N[x] = N[x] + 1
  return Normalize(N[X])</code></pre>
<p>(3). 拒絕取樣演算法 (Rejection Sampling)</p>
<p>目標：計算出符合證據 e 的所有機率分布 <img src="../timg/585454ba939b.jpg" /></p>
<pre><code>Algorithm Rejection-Sampling(X, e, bn, N)
  input : X , the query variable
             e, evidence spedified as an event
             bn, a Bayesian network specifying joint distribution [[ ![](../timg/a7ca5f56a51d.jpg) ]]
             N, the total number of samples to be generated
  for i=1 to N do
      x = Prior-Sampling(bn)
      if x is consistent with e then
        N[x] = N[x] + 1 where x is the value of X in x
  return Normalize(N[X])</code></pre>
<p>問題：當 e 事件的發生機率很小時，大部分 Prior-Sampling 的樣本都被拒絕了，因此可能會很浪費時間。</p>
<p>(4). 似然加權演算法 (Likelihood Weighting)</p>
<p>目標：計算出符合證據 e 的所有機率分布 [[ <img src="../timg/c03f5a31eb7d.jpg" /> ]] 改進：只產生與 e 一致的事件</p>
<pre><code>Algorithm Likelihood-Weighting(X, e, bn, N) returns an estimate of P(X|e)
  input : X , the query variable
             e, evidence spedified as an event
             bn, a Bayesian network specifying joint distribution [[ ![](../timg/a7ca5f56a51d.jpg) ]]
             N, the total number of samples to be generated
  local variables : W, a vector of weighted counts over X, initially zero.
  for j=1 to N do
      x, w = Weighted-Sample(bn)
      W[x] = W[x] + w;  where x is the value of X in {x}
  return Normalize(W[x])

Algorithm Weighted-Sample(bn, e) returns an event and a weight
  x = an event with n elements; w=1;
  for i = 1 to n do
       if Xi has a value xi in e
           then w = w * P(Xi=xi | parent(Xi))
           else xi = a random sample from P(Xi | parents(Xi))
  return x,w</code></pre>
<h2 id="參考文獻"><a href="#參考文獻">參考文獻</a></h2>
<ul>
<li>維基百科編者 (2010). 貝氏網路. Wikipedia, . Retrieved 08:58, 1月 11, 2010 from http://zh.wikipedia.org/w/index.php?title=%E8%B2%9D%E6%B0%8F%E7%B6%B2%E8%B7%AF&amp;oldid=12052149.</li>
<li>Stuart Russell and Peter Norvig, Artificial Intelligence: A Modern Approach, [1], Prentice Hall, 2nd ed., 2002. ISBN 0137903952.</li>
<li>人工智慧－現代方法(第二版), 譯者：高超群, 出版社：全華科技, 出版日期：2006年10月12日, 語言：繁體中文, ISBN：9861544038</li>
</ul>
<pre class="sourceCode CS"><code class="sourceCode cs"><span class="kw">using</span> System;
<span class="kw">using</span> System.<span class="fu">Collections</span>.<span class="fu">Generic</span>;
<span class="kw">using</span> System.<span class="fu">Linq</span>;
<span class="kw">using</span> System.<span class="fu">Text</span>;
<span class="kw">using</span> ccc.<span class="fu">set</span>;

<span class="kw">namespace</span> ccc.<span class="fu">probability</span>
{
    <span class="co">// 隨機源：貝氏網路 BNT 有 BEAJM 五個節點，其中 B=&gt;A, E=&gt;A, A=&gt;J, A=&gt;M 有連線，</span>
    <span class="co">// 節點的機率為 P(B)=0.001, P(E)=0.002，</span>
    <span class="co">// 連線的機率為 P(A|B,E)=0.95, P(A|B,-E)=0.94, P(A|-B,E)=0.29, P(A|-B,-E)=0.001</span>
    <span class="co">// P(J|A)=0.90, P(J|-A)=0.05, P(M|A)=0.70, P(M|-A)=0.01。</span>
    <span class="co">// 參考文獻：AIMA 教科書第二版, 圖 14.2。</span>

    <span class="kw">public</span> <span class="kw">class</span> BayesNetProblem1 : ProbProblem
    {
        <span class="kw">public</span> String vars = <span class="st">&quot;B,E,A,J,M&quot;</span>;
        <span class="kw">public</span> Map&lt;String, String&gt; parents = <span class="kw">new</span> Map&lt;String, String&gt;();
        <span class="kw">public</span> Map&lt;String, String&gt; values = <span class="kw">new</span> Map&lt;String, String&gt;();

        <span class="kw">public</span> <span class="fu">BayesNetProblem1</span>()
        {
            parents[<span class="st">&quot;B&quot;</span>] = <span class="st">&quot;&quot;</span>;
            parents[<span class="st">&quot;E&quot;</span>] = <span class="st">&quot;&quot;</span>;
            parents[<span class="st">&quot;A&quot;</span>] = <span class="st">&quot;B,E&quot;</span>;
            parents[<span class="st">&quot;J&quot;</span>] = <span class="st">&quot;A&quot;</span>;
            parents[<span class="st">&quot;M&quot;</span>] = <span class="st">&quot;A&quot;</span>;

            values[<span class="st">&quot;B&quot;</span>] = <span class="st">&quot;b,-b&quot;</span>;
            values[<span class="st">&quot;E&quot;</span>] = <span class="st">&quot;e,-e&quot;</span>;
            values[<span class="st">&quot;A&quot;</span>] = <span class="st">&quot;a,-a&quot;</span>;
            values[<span class="st">&quot;J&quot;</span>] = <span class="st">&quot;j,-j&quot;</span>;
            values[<span class="st">&quot;M&quot;</span>] = <span class="st">&quot;m,-m&quot;</span>;

            <span class="fu">prob</span>(<span class="st">&quot;b&quot;</span>, <span class="fl">0.001</span>);
            <span class="fu">prob</span>(<span class="st">&quot;e&quot;</span>, <span class="fl">0.002</span>);
            <span class="fu">prob</span>(<span class="st">&quot;a|b,e&quot;</span>, <span class="fl">0.95</span>);
            <span class="fu">prob</span>(<span class="st">&quot;a|b,-e&quot;</span>, <span class="fl">0.94</span>);
            <span class="fu">prob</span>(<span class="st">&quot;a|-b,e&quot;</span>, <span class="fl">0.29</span>);
            <span class="fu">prob</span>(<span class="st">&quot;a|-b,-e&quot;</span>, <span class="fl">0.001</span>);
            <span class="fu">prob</span>(<span class="st">&quot;j|a&quot;</span>, <span class="fl">0.90</span>);
            <span class="fu">prob</span>(<span class="st">&quot;j|-a&quot;</span>, <span class="fl">0.05</span>);
            <span class="fu">prob</span>(<span class="st">&quot;m|a&quot;</span>, <span class="fl">0.7</span>);
            <span class="fu">prob</span>(<span class="st">&quot;m|-a&quot;</span>, <span class="fl">0.01</span>);
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">prob</span>(String exp, <span class="dt">double</span> p) { <span class="fu">d</span>(exp, p, <span class="st">&quot;-&quot;</span> + exp); }

        <span class="kw">public</span> <span class="kw">override</span> String <span class="fu">generate</span>()
        {
            String A,B,C,D,E;
            A = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;A&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;A&quot;</span>), <span class="st">&quot;-A&quot;</span>);
            B = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;B&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;B&quot;</span>), <span class="st">&quot;-B&quot;</span>);
            C = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;C&quot;</span>, <span class="fu">p</span>(A)*<span class="fu">p</span>(B), <span class="st">&quot;-C&quot;</span>);
            D = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;D&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;D|&quot;</span> + C), <span class="st">&quot;-D&quot;</span>);
            E = PR.<span class="fu">randomSelect</span>(<span class="st">&quot;E&quot;</span>, <span class="fu">p</span>(<span class="st">&quot;D|&quot;</span> + C), <span class="st">&quot;-E&quot;</span>);
            <span class="kw">return</span> A + <span class="st">&quot;,&quot;</span> + B + <span class="st">&quot;,&quot;</span> + C + <span class="st">&quot;,&quot;</span> + D + <span class="st">&quot;,&quot;</span> + E;
        }

        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">test</span>()
        {
            <span class="dt">var</span> net = <span class="kw">new</span> <span class="fu">BayesNetModel</span>();
            net.<span class="fu">vars</span> = vars; net.<span class="fu">parents</span> = parents; net.<span class="fu">values</span> = values; net.<span class="fu">d</span> = <span class="kw">this</span>;
            ProbMap pb = net.<span class="fu">enumerationAsk</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;j,m&quot;</span>);
            pb.<span class="fu">log</span>();
        }
    }

    <span class="kw">public</span> <span class="kw">class</span> BayesNetModel : ProbModel
    {
        <span class="kw">public</span> String vars;
        <span class="kw">public</span> Map&lt;String, String&gt; parents, values;

        <span class="kw">public</span> <span class="kw">override</span> <span class="dt">double</span> <span class="fu">p</span>(<span class="dt">string</span> exp)
        {
            <span class="kw">try</span> { 
                <span class="dt">double</span> prob = <span class="kw">base</span>.<span class="fu">p</span>(exp);
                Log.<span class="fu">log</span>(<span class="st">&quot;p(&quot;</span> + exp + <span class="st">&quot;) = &quot;</span> + prob);
                <span class="kw">return</span> prob;
            } 
            <span class="kw">catch</span> 
            {
                Log.<span class="fu">log</span>(<span class="st">&quot;p(&quot;</span> + exp + <span class="st">&quot;) = Error!&quot;</span>);
                <span class="kw">throw</span> <span class="kw">new</span> <span class="fu">Exception</span>();
            }
        }

        <span class="kw">public</span> ProbMap <span class="fu">enumerationAsk</span>(String X, String e)
        {
            ProbMap px = <span class="kw">new</span> <span class="fu">ProbMap</span>();
            String[] xvalues = values[X].<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>);
            <span class="kw">foreach</span> (var x <span class="kw">in</span> xvalues)
                px[x+<span class="st">&quot;|&quot;</span>+e] = <span class="fu">enumerateAll</span>(vars, e+<span class="st">&quot;,&quot;</span>+x);
            <span class="kw">return</span> px.<span class="fu">normalize</span>();
        }

        <span class="kw">public</span> <span class="dt">double</span> <span class="fu">enumerateAll</span>(String vars, String e)
        {
            <span class="kw">if</span> (vars == <span class="st">&quot;&quot;</span>) <span class="kw">return</span> <span class="fl">1.0</span>;
            String Y = vars.<span class="fu">head</span>(<span class="st">&quot;,&quot;</span>);
            String rest = vars.<span class="fu">tail</span>(<span class="st">&quot;,&quot;</span>);
            String[] yvalues = values[Y].<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>);
            IEnumerable&lt;String&gt; yset = e.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>).<span class="fu">Intersect</span>(yvalues);
            <span class="dt">var</span> y = yset.<span class="fu">Count</span>() &gt; <span class="dv">0</span> ? yset.<span class="fu">First</span>() : <span class="kw">null</span>;
            <span class="kw">if</span> (y != <span class="kw">null</span>) 
                <span class="kw">return</span> <span class="fu">pcond</span>(y, Y, e) * <span class="fu">enumerateAll</span>(rest, e);
            <span class="kw">else</span>
            {
                <span class="dt">double</span> psum = <span class="fl">0.0</span>;
                <span class="kw">foreach</span> (var yi <span class="kw">in</span> yvalues)
                {
                    psum += <span class="fu">pcond</span>(yi, Y, e) * <span class="fu">enumerateAll</span>(rest, e + <span class="st">&quot;,&quot;</span> + yi);
                }
                <span class="kw">return</span> psum;
            }
        }

        <span class="kw">public</span> <span class="dt">double</span> <span class="fu">pcond</span>(String y, String Y, String e)
        {
            <span class="kw">return</span> <span class="fu">p</span>(y + <span class="st">&quot;|&quot;</span> + <span class="fu">bind</span>(parents[Y], e));
        }

        <span class="kw">public</span> String <span class="fu">bind</span>(String pVars, String pValues)
        {
            <span class="kw">if</span> (pVars.<span class="fu">Trim</span>() == <span class="st">&quot;&quot;</span>) <span class="kw">return</span> <span class="st">&quot;&quot;</span>;
            String[] vars = pVars.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>);
            String[] vals = pValues.<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>);
            <span class="kw">for</span> (<span class="dt">int</span> i=<span class="dv">0</span>; i&lt; vars.<span class="fu">Length</span>; i++) 
            {
                <span class="dt">var</span> val = values[vars[i]].<span class="fu">split</span>(<span class="st">&quot;,&quot;</span>).<span class="fu">Intersect</span>(vals);
                <span class="kw">if</span> (val.<span class="fu">Count</span>() &gt; <span class="dv">0</span>)
                    vars[i] = val.<span class="fu">First</span>();
            }
            <span class="kw">return</span> vars.<span class="fu">merge</span>(&#39;,&#39;);
        }
    }
}</code></pre>
</div>
<div id="footer">
<a href="http://ccckmit.wikidot.com">陳鍾誠</a>衍生自<a href="http://zh.wikipedia.org/">維基百科</a>之作品：採用 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/ ">創作共用：姓名標示、相同方式分享</a> 的 <a href="license.html">授權方式</a>。
</div>
</body>
</html>
